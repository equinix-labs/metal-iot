# iot

IoT lab

## Getting started

### 1) Clone the repo

```sh
git clone https://github.com/packet-labs/iot
```

### 2) Apply Terraform

Remember to set your Packet API and project ID before running this step.

### 3) Install Postgres via KubeDB and helm

You will need to install helm for this step.

* Install [postgresql](/postgresql/)

### 4) Add the MQTT Broker (Emitter.io)

* Install [emitter](/emitter/)

More info at: https://emitter.io

* Navigate to `http://IP:port/keygen` where `IP` is the address of your Emitter.io deployment

* Generate a channel key for the topic `drone-position`

![](/docs/images/keygen.png)

You'll need this key to configure the OpenFaaS Connector

### 5) Install OpenFaaS

* Install [openfaas](/openfaas/)

### 6) Add the OpenFaaS MQTT-Connector

The MQTT-Connector is used to trigger functions and services in response to messages generated by the event source.

The topic is `drone-position`.

```sh
git clone //github.com/openfaas-incubator/mqtt-connector
cd mqtt-connector
```

Edit `chart/mqtt-connector/values.yaml` and update the CHANNEL_KEY value from the step above.

Apply the changes:

```sh
cd mqtt-connector/chart/

helm template -n openfaas --namespace openfaas mqtt-connector/ --values mqtt
-connector/values.yaml | kubectl apply -f -
```

## TBD/backlog

* Deploy business insights software
* Create OpenFaaS Function: insert row
* Create Postgesql schema asset
* Create OpenFaaS service for viewing data on mapbox
* Create OpenFaaS Function: Query drone positions for mapbox
